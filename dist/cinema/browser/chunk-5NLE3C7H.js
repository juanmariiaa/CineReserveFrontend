import{a as W}from"./chunk-LUQKNZDT.js";import{a as $}from"./chunk-RMTH5SD5.js";import"./chunk-X4G2UA5K.js";import"./chunk-JJT6K3XQ.js";import{a as U,b as j}from"./chunk-E2NKI5YT.js";import"./chunk-NSEFZZEN.js";import{a as A,b as H}from"./chunk-DDVV6NKZ.js";import"./chunk-OQJFGUDZ.js";import{b as V,c as Y}from"./chunk-FCZTQVRE.js";import"./chunk-2FAWVZHA.js";import"./chunk-SZLBBELY.js";import{o as B,s as D}from"./chunk-NRVZBHM6.js";import{g as Q}from"./chunk-UTQDTBMQ.js";import{f as S,ga as L,ha as N,i as w,l as E,t as I,u as R,v as T,x as z,y as q}from"./chunk-BTJY3BD6.js";import{Db as m,Mb as t,Nb as n,Ob as d,Sb as y,Wb as O,X as M,Xb as g,cb as P,fb as r,gc as i,hc as p,ic as f,jc as k,kb as l,p as h,qa as C,ra as _,rb as b,rc as v,tc as x,wb as u}from"./chunk-HKKO7SBW.js";function G(o,a){o&1&&(t(0,"div",5),d(1,"mat-spinner",6),t(2,"p"),i(3,"Loading your ticket..."),n()())}function J(o,a){if(o&1&&(t(0,"div",7)(1,"mat-icon",8),i(2,"error"),n(),t(3,"h2"),i(4,"Error loading your ticket"),n(),t(5,"p"),i(6),n(),t(7,"p",9),i(8," If you received an email with your ticket, you can use it directly. "),n(),t(9,"div",10)(10,"button",11),i(11," View my reservations "),n(),t(12,"button",12),i(13,"Back to home"),n()()()),o&2){let e=g();r(6),p(e.errorMessage)}}function K(o,a){if(o&1&&d(0,"img",32),o&2){let e=g(2);m("src",e.qrImageUrl,P)}}function X(o,a){if(o&1){let e=y();t(0,"div",13)(1,"div",14)(2,"mat-icon",15),i(3,"check_circle"),n(),t(4,"h1"),i(5,"Payment Completed Successfully!"),n(),t(6,"p"),i(7,"Your reservation has been confirmed and your ticket is ready."),n(),t(8,"p",16),i(9," We've also sent a copy of your ticket to your email. "),n()(),t(10,"div",17)(11,"div",18)(12,"h1"),i(13,"CineReserve"),n(),t(14,"h2"),i(15,"Movie Ticket"),n()(),t(16,"div",19),u(17,K,1,1,"img",20),t(18,"p",21),i(19),n()(),d(20,"mat-divider"),t(21,"div",22)(22,"div",23)(23,"span",24),i(24,"Movie:"),n(),t(25,"span",25),i(26),n()(),t(27,"div",23)(28,"span",24),i(29,"Room:"),n(),t(30,"span",25),i(31),n()(),t(32,"div",23)(33,"span",24),i(34,"Date:"),n(),t(35,"span",25),i(36),v(37,"date"),n()(),t(38,"div",23)(39,"span",24),i(40,"Time:"),n(),t(41,"span",25),i(42),v(43,"date"),n()(),t(44,"div",23)(45,"span",24),i(46,"Seats:"),n(),t(47,"span",25),i(48),n()(),t(49,"div",23)(50,"span",24),i(51,"Customer:"),n(),t(52,"span",25),i(53),n()()(),d(54,"mat-divider"),t(55,"div",26)(56,"p"),i(57,"This ticket is valid only for the specified screening."),n(),t(58,"p"),i(59," Present it at the cinema entrance 15 minutes before the movie starts. "),n()()(),t(60,"div",27)(61,"h3"),i(62,"What to do with your ticket?"),n(),t(63,"ul")(64,"li"),i(65," You can print this ticket and show it at the cinema box office. "),n(),t(66,"li"),i(67," You can also show the QR code directly from your mobile device. "),n(),t(68,"li"),i(69," We've sent a copy to your email so you'll always have it available. "),n()()(),t(70,"div",28)(71,"button",29),O("click",function(){C(e);let s=g();return _(s.printTicket())}),t(72,"mat-icon"),i(73,"print"),n(),i(74," Print Ticket "),n(),t(75,"button",30)(76,"mat-icon"),i(77,"list"),n(),i(78," My Reservations "),n(),t(79,"button",31)(80,"mat-icon"),i(81,"home"),n(),i(82," Back to Home "),n()()()}if(o&2){let e=g();r(17),m("ngIf",e.qrImageUrl),r(2),f("Reservation ID: ",e.reservation==null?null:e.reservation.id,""),r(7),p(e.reservation==null||e.reservation.screening==null||e.reservation.screening.movie==null?null:e.reservation.screening.movie.title),r(5),f("Room ",e.reservation==null||e.reservation.screening==null||e.reservation.screening.room==null?null:e.reservation.screening.room.number,""),r(5),p(x(37,9,e.reservation==null||e.reservation.screening==null?null:e.reservation.screening.startTime,"MM/dd/yyyy")),r(6),p(x(43,12,e.reservation==null||e.reservation.screening==null?null:e.reservation.screening.startTime,"HH:mm")),r(6),p(e.seatsList),r(5),k("",e.reservation==null||e.reservation.user==null?null:e.reservation.user.firstName," ",e.reservation==null||e.reservation.user==null?null:e.reservation.user.lastName,"")}}var F=class o{constructor(a,e,c,s,Z){this.route=a;this.router=e;this.reservationService=c;this.snackBar=s;this.sanitizer=Z}loading=!0;error=!1;errorMessage="";reservation=null;qrImageUrl=null;seatsList="";ngOnInit(){this.route.queryParams.subscribe(a=>{let e=a.session_id;e?this.loadReservationDetails(e):(this.error=!0,this.loading=!1,this.errorMessage='Could not identify the reservation. Incomplete URL parameters. Please check your "My Reservations" section or your email.')})}loadReservationDetails(a){this.reservationService.getReservationBySessionId(a).pipe(M(e=>{if(!e)throw new Error("No reservation was found associated with this payment session.");if(this.reservation=e,e&&e.seatReservations&&e.seatReservations.length>0){let c=e.seatReservations.map(s=>s.seat&&s.seat.rowLabel&&s.seat.columnNumber?`${s.seat.rowLabel}${s.seat.columnNumber}`:null).filter(s=>s!==null);this.seatsList=c.join(", ")}else this.seatsList="No seats information available";return this.generateQRCode(e.id.toString()),h(e)})).subscribe({next:()=>{this.loading=!1},error:e=>{console.error("Error loading reservation details",e),this.loading=!1,this.error=!0,e.status===404?this.errorMessage="No reservation was found associated with this payment session. The payment may have been processed correctly but the details are not available at this time.":e.status===401||e.status===403?this.errorMessage="You do not have permission to access this reservation. Please make sure you are logged in with the correct account.":e.status===0?this.errorMessage="Could not connect to the server. Please check your internet connection.":this.errorMessage='Error loading reservation details. Please check "My Reservations" or check your email where we have also sent your ticket.',this.snackBar.open("Error loading ticket","Close",{duration:5e3})}})}generateQRCode(a){let e=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(a)}`;this.qrImageUrl=this.sanitizer.bypassSecurityTrustUrl(e)}printTicket(){window.print()}static \u0275fac=function(e){return new(e||o)(l(T),l(z),l(W),l(V),l(R))};static \u0275cmp=b({type:o,selectors:[["app-payment-success"]],decls:6,vars:3,consts:[[1,"payment-success-container"],[1,"content"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","ticket-container",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"error-container"],["color","warn"],[1,"error-details"],[1,"error-actions"],["mat-raised-button","","color","primary","routerLink","/my-reservations"],["mat-raised-button","","routerLink","/"],[1,"ticket-container"],[1,"success-message"],["color","accent"],[1,"email-note"],[1,"ticket"],[1,"ticket-header"],[1,"ticket-qr"],["alt","QR Code","class","qr-code",3,"src",4,"ngIf"],[1,"reservation-id"],[1,"ticket-details"],[1,"detail-row"],[1,"label"],[1,"value"],[1,"ticket-footer"],[1,"ticket-instructions"],[1,"actions"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","accent","routerLink","/my-reservations"],["mat-raised-button","","color","primary","routerLink","/"],["alt","QR Code",1,"qr-code",3,"src"]],template:function(e,c){e&1&&(t(0,"div",0),d(1,"app-navbar"),t(2,"div",1),u(3,G,4,0,"div",2)(4,J,14,1,"div",3)(5,X,83,15,"div",4),n()()),e&2&&(r(3),m("ngIf",c.loading),r(),m("ngIf",!c.loading&&c.error),r(),m("ngIf",!c.loading&&!c.error))},dependencies:[E,S,w,q,Q,D,B,N,L,H,A,j,U,$,I,Y],styles:[".payment-success-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;background-color:#3c3b34;color:#fff;font-family:Roboto,sans-serif}.content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex:1;padding:2rem}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;max-width:500px;margin:0 auto;color:#fff}.loading-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-bottom:1rem}.error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;color:#f44336}.error-details[_ngcontent-%COMP%]{margin:1rem 0;color:#ffffffb3}.error-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem}.ticket-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:2rem;width:100%;max-width:800px}.success-message[_ngcontent-%COMP%]{text-align:center;background-color:#35342e;padding:2rem;border-radius:8px;box-shadow:0 4px 12px #0000004d;width:100%;color:#fff;border:1px solid rgba(255,255,255,.1)}.success-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:1rem;color:#ff6b6b}.success-message[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#fff;margin-bottom:1rem}.success-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fffc;margin-bottom:.5rem}.email-note[_ngcontent-%COMP%]{font-style:italic;margin-top:1rem;color:#fff9}.ticket[_ngcontent-%COMP%]{background-color:#35342e;border-radius:8px;box-shadow:0 4px 20px #0000004d;width:100%;overflow:hidden;padding:1.5rem;border:1px solid rgba(255,255,255,.1)}.ticket-instructions[_ngcontent-%COMP%]{background-color:#35342e;border-radius:8px;box-shadow:0 4px 12px #0000004d;width:100%;padding:1.5rem;color:#fff;border:1px solid rgba(255,255,255,.1)}.ticket-instructions[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#fff;margin-bottom:1rem}.ticket-instructions[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:1.5rem;margin-bottom:0}.ticket-instructions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.5rem;color:#fffc}.ticket-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem}.ticket-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:28px;margin-bottom:.5rem;color:#ff6b6b}.ticket-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;color:#ffffffe6;font-weight:400}.ticket-qr[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:1.5rem;background-color:#fff;padding:1rem;border-radius:8px}.qr-code[_ngcontent-%COMP%]{width:180px;height:180px;margin-bottom:.5rem}.reservation-id[_ngcontent-%COMP%]{color:#333;font-size:14px}mat-divider[_ngcontent-%COMP%]{margin:1rem 0;background-color:#ffffff1a}.ticket-details[_ngcontent-%COMP%]{margin:1.5rem 0}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.8rem;font-size:16px}.label[_ngcontent-%COMP%]{font-weight:500;color:#ffffffb3}.value[_ngcontent-%COMP%]{color:#fff;text-align:right}.ticket-footer[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;color:#ffffffb3;font-size:14px}.ticket-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:.5rem}.actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;width:100%}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:160px}.actions[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:20px;height:20px;width:20px;vertical-align:middle}@media print{.actions[_ngcontent-%COMP%], app-navbar[_ngcontent-%COMP%], .success-message[_ngcontent-%COMP%], .ticket-instructions[_ngcontent-%COMP%]{display:none!important}.ticket-container[_ngcontent-%COMP%]{max-width:100%}.ticket[_ngcontent-%COMP%]{box-shadow:none;border:1px solid #ddd;background-color:#fff;color:#000}.ticket-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#ff6b6b}.ticket-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .label[_ngcontent-%COMP%], .value[_ngcontent-%COMP%], .ticket-footer[_ngcontent-%COMP%], .ticket-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#000}}@media (max-width: 600px){.detail-row[_ngcontent-%COMP%]{flex-direction:column;margin-bottom:1.2rem}.value[_ngcontent-%COMP%]{text-align:left;margin-top:.3rem}.actions[_ngcontent-%COMP%]{flex-direction:column;width:100%}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.error-actions[_ngcontent-%COMP%]{flex-direction:column;width:100%}}"]})};export{F as PaymentSuccessComponent};
