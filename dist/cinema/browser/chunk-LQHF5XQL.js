import{a as O}from"./chunk-UMU2FEH2.js";import{a as n}from"./chunk-2FAWVZHA.js";import{o as S,p as $}from"./chunk-BTJY3BD6.js";import{F as f,X as d,a as u,b as M,ba as b,ga as h,p as c,t as p}from"./chunk-HKKO7SBW.js";var W=class g{constructor(e,i){this.http=e;this.screeningService=i}createMovieFromTMDB(e){return this.http.post(`${n.apiUrl}/movies/tmdb/${e}`,{})}getMovie(e){return this.http.get(`${n.apiUrl}/movies/${e}`)}searchMovies(e){return this.http.get(`${n.apiUrl}/movies/search`,{params:{name:e}})}getAllMovies(){return this.http.get(`${n.apiUrl}/movies`)}getMovieById(e){return this.http.get(`${n.apiUrl}/movies/${e}`)}getFilteredMovies(e,i,r,s,o,a){let t=new S;return e&&(t=t.append("searchTerm",e)),i&&i.length>0&&i.forEach(l=>{t=t.append("genres",l)}),r&&(t=t.append("duration",r)),s&&(t=t.append("rating",s)),o&&(t=t.append("timeFrame",o)),a&&(t=t.append("sortBy",a)),this.http.get(`${n.apiUrl}/movies/filter`,{params:t})}getAllGenres(){return this.http.get(`${n.apiUrl}/movies/genres`)}getTrendingMovies(){return this.getFilteredMovies(void 0,void 0,void 0,void 0,void 0,"rating").pipe(f(()=>this.getAllMovies().pipe(p(e=>e.map(r=>M(u({},r),{nextScreening:Math.random()>.3?{screeningId:Math.floor(Math.random()*1e3),date:new Date(Date.now()+Math.floor(Math.random()*7*24*60*60*1e3)),formattedTime:`${String(Math.floor(Math.random()*24)).padStart(2,"0")}:${["00","15","30","45"][Math.floor(Math.random()*4)]}`}:void 0})).sort((r,s)=>(s.voteAverage||0)-(r.voteAverage||0))))))}deleteMovie(e){return this.http.delete(`${n.apiUrl}/movies/${e}`)}getMoviesWithFutureScreenings(){return this.screeningService.getAllScreeningsBasic().pipe(p(e=>{let i=new Date,r=e.filter(o=>new Date(o.startTime)>i);return[...new Set(r.map(o=>o.movieId))]}),d(e=>e.length===0?c([]):this.getAllMovies().pipe(p(i=>i.filter(r=>r.id&&e.includes(r.id))))))}getFilteredMoviesWithFutureScreenings(e,i,r,s,o,a){return this.getMoviesWithFutureScreenings().pipe(d(t=>{if(t.length===0)return c([]);let l=t.map(v=>v.id).filter(v=>v!==void 0);return this.getFilteredMovies(e,i,r,s,o,a).pipe(p(v=>v.filter(m=>m.id&&l.includes(m.id))))}))}static \u0275fac=function(i){return new(i||g)(h($),h(O))};static \u0275prov=b({token:g,factory:g.\u0275fac,providedIn:"root"})};export{W as a};
