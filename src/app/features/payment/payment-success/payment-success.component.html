<div class="payment-success-container">
      <app-navbar></app-navbar>

      <div class="content">
        <div *ngIf="loading" class="loading-container">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Cargando tu entrada...</p>
        </div>

        <div *ngIf="!loading && error" class="error-container">
          <mat-icon color="warn">error</mat-icon>
          <h2>Error al cargar tu entrada</h2>
          <p>{{ errorMessage }}</p>
          <p class="error-details">
            Si has recibido un correo electrónico con tu entrada, puedes usarlo
            directamente.
          </p>
          <div class="error-actions">
            <button
              mat-raised-button
              color="primary"
              routerLink="/my-reservations"
            >
              Ver mis reservas
            </button>
            <button mat-raised-button routerLink="/">Volver al inicio</button>
          </div>
        </div>

        <div *ngIf="!loading && !error" class="ticket-container">
          <div class="success-message">
            <mat-icon color="primary">check_circle</mat-icon>
            <h1>¡Pago completado con éxito!</h1>
            <p>Tu reserva ha sido confirmada y tu entrada está lista.</p>
            <p class="email-note">
              También hemos enviado una copia de tu entrada a tu correo
              electrónico.
            </p>
          </div>

          <div class="ticket">
            <div class="ticket-header">
              <h1>CineReserve</h1>
              <h2>Entrada de Cine</h2>
            </div>

            <div class="ticket-qr">
              <img
                [src]="qrImageUrl"
                alt="Código QR"
                class="qr-code"
                *ngIf="qrImageUrl"
              />
              <p class="reservation-id">ID de Reserva: {{ reservation?.id }}</p>
            </div>

            <mat-divider></mat-divider>

            <div class="ticket-details">
              <div class="detail-row">
                <span class="label">Película:</span>
                <span class="value">{{
                  reservation?.screening?.movie?.title
                }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Sala:</span>
                <span class="value"
                  >Sala {{ reservation?.screening?.room?.number }}</span
                >
              </div>
              <div class="detail-row">
                <span class="label">Fecha:</span>
                <span class="value">{{
                  reservation?.screening?.startTime | date : 'dd/MM/yyyy'
                }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Hora:</span>
                <span class="value">{{
                  reservation?.screening?.startTime | date : 'HH:mm'
                }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Asientos:</span>
                <span class="value">{{ seatsList }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Cliente:</span>
                <span class="value"
                  >{{ reservation?.user?.firstName }}
                  {{ reservation?.user?.lastName }}</span
                >
              </div>
            </div>

            <mat-divider></mat-divider>

            <div class="ticket-footer">
              <p>Esta entrada es válida solo para la función indicada.</p>
              <p>
                Preséntala en la entrada del cine 15 minutos antes del inicio de
                la película.
              </p>
            </div>
          </div>

          <div class="ticket-instructions">
            <h3>¿Qué hacer con tu entrada?</h3>
            <ul>
              <li>
                Puedes imprimir esta entrada y mostrarla en la taquilla del
                cine.
              </li>
              <li>
                También puedes mostrar el código QR directamente desde tu
                dispositivo móvil.
              </li>
              <li>
                Hemos enviado una copia a tu correo electrónico para que la
                tengas siempre disponible.
              </li>
            </ul>
          </div>

          <div class="actions">
            <button mat-raised-button color="primary" (click)="printTicket()">
              <mat-icon>print</mat-icon> Imprimir Entrada
            </button>
            <button
              mat-raised-button
              color="accent"
              routerLink="/my-reservations"
            >
              <mat-icon>list</mat-icon> Mis Reservas
            </button>
            <button mat-raised-button routerLink="/">
              <mat-icon>home</mat-icon> Volver al Inicio
            </button>
          </div>
        </div>
      </div>
    </div>